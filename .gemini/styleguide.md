# レビューガイド

## 1. はじめに

本文書は、BitzParserプロジェクトにおける**全てのドキュメント**（システム仕様書、開発仕様書、詳細仕様書、インターフェイス仕様書、理論解説、ユースケース、READMEファイルなど、Markdown形式で記述されるもの全般）を作成・編集する際の**スタイルガイド**です。同時に、これらのドキュメント、および**プロジェクトのC#ソースコード**をレビューする際の**チェックリストおよび指針**としても機能します。

本ガイドラインは、「[02. 開発仕様書](../README.md)」の一部として位置づけられ、プロジェクト全体のドキュメントおよびコードの品質を高いレベルで維持し、一貫性を確保することを目的としています。明確で、正確かつ保守性の高いドキュメントとコードは、プロジェクトの理解を深め、開発効率を向上させ、将来のコントリビューターを含む全ての関係者にとって価値のある情報資産となります。

**主要言語:** 本プロジェクトのドキュメントは、原則として**日本語**で記述します。コード例、API名、国際的に認知された技術用語、参考文献など、英語表記が適切または一般的な場合は、その限りではありません。英語表記を併用する際のスタイルについても本ガイドで触れます。C#ソースコード内のコメントや識別子は原則として英語とします。レビューなどは、すべて日本語で回答してください。

**対象読者:** 本ガイドラインは、BitzParserプロジェクトのドキュメント作成、コード記述、およびそれらのレビューに携わる全てのコントリビューター（現時点では主に開発者自身）を対象とします。

**本文書の構成:**
本文書は、一般的なドキュメントレビューの観点から始まり、基本的な書式設定、Markdownの具体的な記述スタイル、特殊コンテンツ（LaTeX数式、Mermaid図）の扱い、用語と表現の統一、ドキュメント間の連携について説明します。さらに、**C#ソースコードに関するコーディング規約のレビュー観点**についても詳述します。

本ガイドラインを遵守することで、BitzParserプロジェクトのドキュメント群とソースコードが、読みやすく、理解しやすく、そして信頼性の高いものとなることを目指します。


## 2. ドキュメントレビューの観点

ドキュメントをレビューする際は、以下の観点を総合的に確認してください。

*   **明確性 (Clarity):** 内容は対象読者にとって分かりやすいか？専門用語は適切に使われているか？
*   **正確性 (Accuracy):** 技術的な記述、数値、参照情報などに誤りはないか？最新の情報に基づいているか？
*   **一貫性 (Consistency):** 本スタイルガイドで定める用語、書式、構造が一貫して適用されているか？
*   **網羅性 (Completeness):** 説明すべき事項が過不足なく記述されているか？読者が必要とする情報が提供されているか？
*   **簡潔性 (Conciseness):** 冗長な表現や不必要な情報はないか？
*   **構成と構造 (Organization and Structure):** 情報は論理的に構成され、見出しやリストが効果的に使われているか？
*   **保守性 (Maintainability):** 将来の変更や更新が容易に行えるように記述されているか？
*   **対象読者への配慮:** ドキュメントの目的と対象読者に合った言葉遣いや詳細度になっているか？

## 3. 基本的な書式とファイル形式

*   **ファイル形式:** 全てのドキュメントはMarkdown形式 (`.md`) を使用します。
    *   *レビューポイント:* 正しいファイル拡張子か？
*   **文字エンコーディング:** UTF-8 (BOMなし) を使用します。
    *   *レビューポイント:* 文字化けなどが発生していないか？
*   **ファイルとフォルダの命名:** 「[開発仕様書/01. フォルダ構成](../02.開発仕様書/01_フォルダ構成.md)」および「[開発仕様書/04. ドキュメント規則](../02.開発仕様書/04_ドキュメント規則.md#4-ファイルとフォルダの命名規則)」で定める規則に従っているか？
    *   *レビューポイント:* 命名規則は守られているか？ファイル名から内容が推測できるか？

## 4. Markdown記述スタイル

「[開発仕様書/04. ドキュメント規則](../02.開発仕様書/04_ドキュメント規則.md#5-markdown記述スタイルガイド)」で定められたスタイルガイドラインに従います。レビュー時には以下の主要な点を確認します。

*   **見出し:**
    *   適切な見出しレベル (H1, H2, H3...) が使用されているか？レベル飛ばしはないか？
    *   見出しテキストは内容を的確に表しているか？
    *   見出しの後に適切な空行があるか？
*   **段落と改行:**
    *   段落間は1行の空行で区切られているか？不必要な強制改行はないか？
*   **リスト:**
    *   順序なしリスト (`-` 推奨)、順序付きリスト (`1.`) が正しく使われているか？
    *   ネストは適切か？
*   **強調:**
    *   イタリック (`*テキスト*`)、ボールド (`**テキスト**`) が目的に応じて適切に使われているか？過度な強調はないか？
*   **コード表記:**
    *   インラインコードは `` ` `` で囲まれているか？
    *   コードブロックは ``` ``` で囲まれ、適切な言語指定がされているか？
*   **リンク:**
    *   **リンクテキスト:** ファイル拡張子 `.md` を含まず、区切り文字は `.` (ドット) を使用しているか？ (例: `[01. システム仕様書]`)
    *   **ファイル内リンク:** `#アンカー名` が正しく、機能しているか？（アンカー名の規則は「[7. ドキュメント間の連携とトレーサビリティ](#7-ドキュメント間の連携とトレーサビリティ)」参照）
    *   **ファイル間リンク:** 相対パスまたはリポジトリルートからの絶対パス (`/Docs/...`) が正しく、機能しているか？
    *   リンク切れはないか？
*   **画像:**
    *   画像パスは正しいか？代替テキストは適切か？
*   **表:**
    *   Markdownテーブル構文が正しく、アライメント指定は適切か？
*   **水平線:**
    *   `---` が使用されているか？

## 5. 特殊な記法と埋め込みコンテンツ

「[開発仕様書/04. ドキュメント規則](../02.開発仕様書/04_ドキュメント規則.md#6-特殊な記法と埋め込みコンテンツ)」で定められたガイドラインに従います。

*   **LaTeX記法による数式表現:**
    *   インライン数式 (`$ ... $`) とブロック数式 (` ```math ... ``` `) が正しく使われているか？
    *   数式環境（`align*`, `gather`など）は適切か？LaTeXコマンド（`\rightarrow`, `\epsilon`など）の使い方は正しいか？
    *   数式は正しくレンダリングされているか（GitHubプレビューなどで確認）？
    *   数式部分の中央揃え（ブロック数式）や、文法規則の桁揃えは意図通りか？
*   **Mermaid図による図表表現:**
    *   ` ```mermaid ... ``` ` ブロックは正しく記述されているか？
    *   図は意図した通りにレンダリングされているか？
    *   キャプションは適切か？ラベル内のコロンやマルチバイト文字の扱いは正しいか？

## 6. 用語と表現

*   **用語の統一:** プロジェクト内で定義された用語（システム仕様書の用語定義など）が一貫して使用されているか？
    *   例: 「先読み (lookahead)」「抽象構文木 (AST)」「機能要件ID (FR-ID)」など。
*   **日本語表現:**
    *   文法的に正しく、自然で分かりやすい日本語か？
    *   誤字脱字、不適切な句読点はないか？
    *   専門用語の乱用や、逆に説明不足な箇所はないか？
    *   三人称（「システムは～する」）が基本となっているか？
*   **英語表記の併用:** コード例、API名、一般的な技術用語、参考文献など、英語表記が適切か？括弧書きでの補足は分かりやすいか？

## 7. ドキュメント間の連携とトレーサビリティ

「[開発仕様書/04. ドキュメント規則](../02.開発仕様書/04_ドキュメント規則.md#7-ドキュメント間の連携とトレーサビリティ)」で定められたガイドラインに従います。

*   **機能要件ID (FR-ID):**
    *   IDの命名規則は守られているか？
    *   システム仕様書で定義されたIDが、他のドキュメント（詳細仕様書、インターフェイス仕様書、ユースケース、理論解説のBitzParser方針など）から正しく参照されているか？
*   **アンカーとリンク:**
    *   機能要件IDの定義箇所に正しいアンカー (`<a id="FR-ID"></a>`) が設定されているか？
    *   相互リンクは正しく機能しているか？リンクテキストは適切か？
*   **参照関係の明確性:** あるドキュメントが他のどのドキュメントを参照し、または参照されているかの関係性が理解できるか？

## 8. 各ドキュメントカテゴリ特有のレビュー観点

*   **システム仕様書 ([01.システム仕様書](/Docs/01.システム仕様書/README.md)):**
    *   要件は明確で、テスト可能で、実現可能か？
    *   スコープは適切に定義されているか？
*   **開発仕様書 ([02.開発仕様書](/Docs/02.開発仕様書/README.md)):**
    *   開発プロセスや規約は実用的で、プロジェクトの目的に合致しているか？
*   **詳細仕様書 ([03.詳細仕様書](/Docs/03.詳細仕様書/README.md)):**
    *   設計はシステム仕様書の要件を満たしているか？技術的な実現性は考慮されているか？
    *   図や説明は十分か？
*   **インターフェイス仕様書 ([04.インターフェイス仕様書](/Docs/04.インターフェイス仕様書/README.md)):**
    *   APIのシグネチャ、パラメータ、戻り値、例外などの記述は正確かつ網羅的か？
    *   「[開発仕様書/06. インターフェイス規則](../02.開発仕様書/06_インターフェイス規則.md)」に準拠しているか？
    *   使用例は分かりやすいか？
*   **ユースケース ([05.ユースケース](/Docs/05.ユースケース/README.md)):**
    *   シナリオは具体的で、ユーザーの視点に立っているか？
    *   事前条件、事後条件、フローは明確か？
*   **理論解説 ([Z1.構文解析](/Docs/Z1.構文解析/README.md)):**
    *   技術的な説明は正確か？参考文献は適切か？
    *   BitzParserにおける位置づけや実装方針との関連は明確か？

## 9. 更新とレビュープロセス

*   ドキュメントの変更は、原則としてプルリクエストを通じて行われているか？
*   セルフレビューは十分に行われているか？
*   関連するドキュメントも必要に応じて更新されているか？
    *   「[開発仕様書/02. ブランチ戦略と命名規則](../02.開発仕様書/02_ブランチ戦略と命名規則.md)」参照。

## 10. コーディング規約のレビュー観点 (C#)

BitzParserのC#ソースコードをレビューする際は、「[開発仕様書/05. コーディング規則](../02.開発仕様書/05_コーディング規則.md)」で定められた規約が遵守されているかを確認します。以下は主要なレビュー観点です。

### 10.1. 基本方針の遵守
*   MicrosoftのC#コーディング規則および名前付けガイドラインから大きく逸脱していないか？
    *   *レビューポイント:* 意図的でない限り、標準的な慣習に従っているか。

### 10.2. 命名規則
*   **PascalCase** および **camelCase** が適切に使用されているか？
    *   クラス、メソッド、プロパティ、イベント、enum、定数、読み取り専用静的フィールドはPascalCaseか？
    *   メソッド引数、ローカル変数はcamelCaseか？
*   インターフェース名は接頭辞 `I` + PascalCaseか？
*   プライベートインスタンスフィールドは `_` + camelCaseか？
*   非公開の静的フィールドは `s_` または `t_` プレフィックス + camelCaseか？
    *   *レビューポイント:* 命名規則に一貫性があり、識別子の目的が名前から推測しやすいか。

### 10.3. レイアウトと書式設定
*   **インデント:** 半角スペース4つで統一されているか？タブ文字が混入していないか？
*   **波括弧 `{}`:**
    *   型定義や名前空間はAllmanスタイル（次の行）か？
    *   制御フローステートメントはK&R風（同じ行）か？
    *   単一行でも波括弧は省略されていないか？
*   **1行の長さ:** 約120文字の目安を超えて、不必要に長い行はないか？適切に改行されているか？
*   **空行:** メソッド間や論理ブロック間に適切に挿入され、可読性を高めているか？過度な空行はないか？
*   **スペース:** 演算子やカンマの周りなど、適切にスペースが使われているか？
*   **`this.` の使用:** プロジェクトで定めた方針（例: 曖昧な場合のみ使用、または常に使用/不使用）に一貫しているか？
    *   *レビューポイント:* コード全体の見た目が整っており、視覚的に追いやすいか。

### 10.4. コメント
*   **XMLドキュメントコメントの不使用:** 原則として `///` コメントは使用されていないか？（APIドキュメントは別途API仕様書で管理）
*   **通常のコメント (`//`, `/* */`):**
    *   コードの意図が自明でない箇所、複雑なロジック、設計上の判断理由などが適切に説明されているか？
    *   「何をしているか」よりも「なぜそうしているのか」が記述されているか？
    *   不要なコメントや古いコメントが残っていないか？
    *   `TODO`, `FIXME` は、その対応状況や背景が明確か？（Issueと連携されていると尚良い）
    *   *レビューポイント:* コメントはコードの理解を助け、保守性を高めるものになっているか。

### 10.5. 言語機能の利用方針
*   **.NET 6+ および C# の最新機能**が、可読性や安全性を損なわない範囲で適切に活用されているか？
    *   `var` の使用は適切か？（型が自明な箇所か）
    *   LINQは効果的に使われているか？過度に複雑なLINQになっていないか？
    *   プロパティは適切に使われ、フィールドは適切に隠蔽されているか？
    *   `using` ステートメント/宣言は `IDisposable` オブジェクトに対して漏れなく使われているか？
    *   null許容参照型 (`#nullable enable`) は有効で、nullの扱いが適切か？（`!`, `?` の使い方は正しいか）
    *   式形式メンバー、タプル、パターンマッチング、レコード型、`init` アクセサ、ファイルスコープ名前空間、`global using` は、それぞれの利点を活かせる場面で適切に使われているか？
    *   *レビューポイント:* モダンなC#の機能を活用しつつも、コードが過度にトリッキーになったり、読みにくくなったりしていないか。

### 10.6. エラー処理と例外
*   API境界での引数チェックと適切な例外（`ArgumentNullException`など）のスローが行われているか？
*   ライブラリ内部のエラーは適切に処理またはラップされているか？
*   エラーメッセージは具体的で、問題解決に役立つ情報を含んでいるか？
*   `catch (Exception)` のような汎用的な例外キャッチや、エラーの握りつぶしはないか？
*   解析エラーは、診断情報として構造化されて返されているか？（例外で中断するのではなく）
    *   *レビューポイント:* エラー処理は堅牢で、利用者に分かりやすいフィードバックを提供できているか。

### 10.7. ソースジェネレータに関するコード
*   **生成されるコード:**
    *   ソースジェネレータによって生成されるコード自体も、可読性や保守性（デバッグ時など）がある程度考慮されているか？
    *   命名規則などは手書きコードと一貫性があるか？
*   **ジェネレータのコード:**
    *   `IIncrementalGenerator` が適切に使用されているか？
    *   パフォーマンスへの配慮（不要な再計算の防止など）がなされているか？
    *   テスト容易性は考慮されているか？
    *   *レビューポイント:* ソースジェネレータがプロジェクトの効率性と品質向上に正しく貢献しているか。

### 10.8. 非同期処理 (`async`/`await`)
*   I/Oバウンドな処理などで `async`/`await` は適切に使用されているか？
*   `Async` サフィックスの命名規則は守られているか？
*   `ConfigureAwait(false)` はライブラリコードとして適切に使用されているか？（UIスレッドへの復帰を避けるため）
*   デッドロックを引き起こすような不適切な非同期処理のパターンはないか？
    *   *レビューポイント:* 非同期処理が正しく効率的に実装され、問題を引き起こさないか。

### 10.9. その他一般
*   **LINQの遅延実行:** 遅延実行の特性が理解され、意図しない挙動を招いていないか？
*   **イミュータビリティ:** 可能な箇所でイミュータブルな設計が採用され、副作用が抑制されているか？
*   **コメントアウトされたコード:** 不要なコードが残置されていないか？（Gitで管理すべき）
*   **警告:** コンパイラ警告は原則として解消されているか？抑制する場合は正当な理由があるか？
*   **単一責任の原則 (SRP):** クラスやメソッドが単一の責務に集中しているか？過度に複雑なクラスやメソッドはないか？
*   **DRY (Don't Repeat Yourself):** コードの重複はないか？共通化できるロジックは適切に抽出されているか？
*   **パフォーマンスクリティカルな箇所:** ボトルネックとなりうる箇所で、不必要なオブジェクト生成や非効率なループ処理などがないか？（プロファイリング結果があれば尚良い）
    *   *レビューポイント:* コード全体がクリーンで、保守しやすく、効率的で、堅牢であるか。
