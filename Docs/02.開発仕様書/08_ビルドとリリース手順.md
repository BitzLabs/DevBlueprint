# 08_ビルドとリリース手順

このドキュメントは、BitzBufferライブラリのビルドプロセス、バージョン管理、およびリリース手順に関するガイドラインを定めます。
一貫性のある、信頼性の高いリリースプロセスは、ライブラリの利用者に対して安定した成果物を提供し、プロジェクトの継続的な発展を支えるために不可欠です。

## 1. ビルドプロセス

*   **FR-BUILD-PROC-001: ローカルビルド環境:**
    *   開発者は、自身のローカル環境でプロジェクト全体（ライブラリ本体、テストプロジェクトなど）をビルドできること。
    *   必要なツール: 最新の.NET SDK (.NET 6以上)、Visual Studio (推奨) または互換性のあるIDE/エディタ。
    *   ビルドコマンド: 標準的な `dotnet build` コマンド、またはVisual Studioのビルド機能を使用します。
*   **FR-BUILD-PROC-002: ソリューション構成:**
    *   `BitzBuffer.sln` ソリューションファイルには、ライブラリ本体 (`BitzBuffer.csproj`)、将来的な `BitzBuffer.Pipelines.csproj`、および関連する全てのテストプロジェクトが含まれること。「[`01_フォルダ構成.md`](./01_フォルダ構成.md)」参照。
*   **FR-BUILD-PROC-003: ビルド構成:**
    *   主要なビルド構成として `Debug` および `Release` を用意します。
    *   `Debug` 構成: デバッグ情報を含み、開発とテストに使用します。
    *   `Release` 構成: 最適化を有効にし、配布用の成果物（NuGetパッケージなど）を生成するために使用します。
*   **FR-BUILD-PROC-004: 継続的インテグレーション (CI):**
    *   **目的:** `main` ブランチへのプッシュ時およびプルリクエスト作成/更新時に、自動的にビルドとテスト（「[`07_テスト戦略.md`](./07_テスト戦略.md)」で定義）を実行し、コードの品質を維持します。
    *   **ツール:** GitHub Actions を利用します。
    *   **ワークフロー:**
        1.  コードのチェックアウト。
        2.  .NET SDKのセットアップ。
        3.  依存関係の復元 (`dotnet restore`)。
        4.  ソリューション全体のビルド (`dotnet build -c Release`)。
        5.  全てのテストの実行 (`dotnet test -c Release --no-build`)。
        6.  (将来的に) コードカバレッジレポートの生成とアップロード。
        7.  (将来的に) 静的コード解析ツールの実行。
    *   CIの成功は、プルリクエストのマージの必須条件とします。

## 2. バージョン管理

*   **FR-BUILD-VER-001: セマンティックバージョニング (Semantic Versioning 2.0.0) の採用:**
    *   ライブラリのバージョン番号は、`MAJOR.MINOR.PATCH` の形式（例: `1.2.3`）で管理します。
    *   プレリリースバージョンには、ハイフンに続けて識別子（例: `1.0.0-alpha.1`, `1.0.0-beta.2`）を付加します。
    *   バージョン番号のインクリメントルールは、「[`06_インターフェイス規則.md`](./06_インターフェイス規則.md)」で定義されたAPIの互換性ポリシーに従います。
*   **FR-BUILD-VER-002: バージョン番号の管理場所:**
    *   ライブラリのバージョン番号は、主にプロジェクトファイル (`.csproj`) 内の `<Version>` または `<VersionPrefix>` タグで管理します。
*   **FR-BUILD-VER-003: Gitタグによるバージョンマーキング:**
    *   正式なリリース（プレリリース含む）時には、対応するコミットに対して `vMAJOR.MINOR.PATCH` (例: `v1.0.0`, `v1.0.0-alpha.1`) の形式でGitタグを付与し、リモートリポジトリにプッシュします。

## 3. リリース手順

リリースプロセスは、慎重かつ段階的に行い、品質を確保します。

*   **FR-BUILD-REL-001: リリース準備ブランチの作成 (オプションだが推奨):**
    *   `main` ブランチから、リリース作業専用のブランチ（例: `release/v1.0.0`）を作成します。「[`02_ブランチ戦略と命名規則.md`](./02_ブランチ戦略と命名規則.md)」参照。
    *   このブランチでは、リリースノートの作成、バージョン番号の最終調整、ドキュメントの更新など、リリースに直接関連する作業のみを行います。
*   **FR-BUILD-REL-002: 最終テストの実施:**
    *   リリース候補のコードに対して、全ての自動テスト（CI経由）が成功していることを確認します。
    *   必要に応じて、手動での探索的テストや、主要なユースケースに基づいたシナリオテストを実施します。
*   **FR-BUILD-REL-003: ドキュメントの更新:**
    *   API仕様書（「`../04.インターフェイス仕様書/`」配下）、README、CHANGELOG（変更履歴）など、関連する全てのドキュメントが最新の状態であることを確認し、必要に応じて更新します。
*   **FR-BUILD-REL-004: バージョン番号の確定とタグ付け:**
    *   プロジェクトファイル内のバージョン番号を確定します。
    *   対応するコミットに対して、適切なバージョンタグを付与し、リモートリポジトリにプッシュします。
*   **FR-BUILD-REL-005: NuGetパッケージの作成:**
    *   `Release` 構成でライブラリをビルドします。
    *   `dotnet pack -c Release` コマンドを使用して、NuGetパッケージ (`.nupkg`) を生成します。
    *   生成されるパッケージには、ライブラリDLL、シンボルファイル (`.snupkg`) が含まれるように設定します。
*   **FR-BUILD-REL-006: NuGetパッケージの公開:**
    *   生成されたNuGetパッケージを、公式NuGetギャラリー (`nuget.org`) に公開します。
    *   `dotnet nuget push` コマンドまたはNuGet Package Explorerなどのツールを使用します。
    *   公開前に、プレリリース版をテスト用のプライベートフィードやローカルで試用することを推奨します。
*   **FR-BUILD-REL-007: リリースノートの公開:**
    *   GitHubのリリース機能を利用して、新しいバージョンをリリースします。
    *   リリースノートには、そのバージョンでの主要な変更点、新機能、バグ修正、破壊的変更（もしあれば）などを記述します。
    *   作成したNuGetパッケージをリリースアセットとして添付します。
*   **FR-BUILD-REL-008: `main` ブランチへのマージ (リリースブランチを使用した場合):**
    *   リリースブランチでの変更（バージョン番号更新、ドキュメント更新など）を `main` ブランチにマージします。
*   **FR-BUILD-REL-009: 関係者への通知 (オプション):**
    *   新しいバージョンがリリースされたことを、関連するチャネル（プロジェクトのREADME、SNSなど）で告知します。

## 4. プレリリースと安定版リリース

*   **FR-BUILD-PRE-001: プレリリース版の活用:**
    *   新機能の早期フィードバックや、大規模な変更のテストのために、アルファ版 (`-alpha`)、ベータ版 (`-beta`)、リリース候補版 (`-rc`) などのプレリリースバージョンを積極的に活用します。
*   **FR-BUILD-PRE-002: 安定版リリースの基準:**
    *   安定版（プレリリース識別子のないバージョン）は、十分なテストが行われ、既知の重大なバグがなく、APIがある程度安定していると判断された場合にリリースします。
