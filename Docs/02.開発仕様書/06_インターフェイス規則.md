# 06_インターフェイス規則

このドキュメントは、BitzBufferプロジェクトが外部の利用者（他のアセンブリや開発者）に対して公開するC# API (Application Programming Interface) の設計、ドキュメンテーション、およびバージョン管理に関する規則とガイドラインを定めます。

質の高い、一貫性のあるインターフェイスは、ライブラリの使いやすさ、学習の容易さ、そして長期的な保守性にとって極めて重要です。BitzBufferは、利用者が直感的に理解でき、堅牢で、かつ拡張しやすいAPIを提供することを目指します。

本規則は、「[`05_コーディング規則.md`](./05_コーディング規則.md)」で定める一般的なコーディング規約を補完し、特に公開インターフェイスに焦点を当てたものです。

## 1. API設計原則

BitzBufferの公開APIを設計する際には、以下の原則を遵守します。

*   **FR-API-DES-001: 明確性と簡潔性 (Clarity and Conciseness):**
    *   APIの各要素（名前空間、型名、メソッド名、パラメータ名など）は、その目的と機能が明確に理解できるように、適切かつ簡潔な名前を付けます。
*   **FR-API-DES-002: 使いやすさ (Usability):**
    *   APIは、C#開発者にとって自然で、一般的な.NETの設計ガイドライン（例: [Microsoft APIデザインガイドライン](https://docs.microsoft.com/dotnet/standard/design-guidelines/)）に沿ったものであること。
    *   最も一般的なユースケースは簡単に実現できるようにし、高度なカスタマイズも可能な設計とします。
*   **FR-API-DES-003: 型安全性 (Type Safety):**
    *   C#の静的型付けシステムの利点を最大限に活用し、コンパイル時に多くのエラーを検出できるようにします。
    *   null許容参照型 (`#nullable enable`) を活用し、APIコントラクトにおけるnullの扱いを明確にします。
*   **FR-API-DES-004: モジュール性と疎結合 (Modularity and Loose Coupling):**
    *   ライブラリの各機能は、可能な限り独立したモジュールとして設計し、API間の依存関係を最小限に抑えます。
*   **FR-API-DES-005: 拡張性と保守性 (Extensibility and Maintainability):**
    *   将来的な機能追加や変更が容易に行えるよう、拡張性を考慮した設計を心がけます。
    *   APIの変更が既存の利用者に与える影響（破壊的変更）を最小限に抑えるよう努めます。
*   **FR-API-DES-006: パフォーマンスへの配慮 (Performance Considerations):**
    *   API設計において、不必要なパフォーマンスのオーバーヘッドを生じさせないよう配慮します。
*   **FR-API-DES-007: 一貫性 (Consistency):**
    *   ライブラリ全体で、命名規則、パラメータの順序、エラー処理の方法などに一貫性を持たせます。
*   **FR-API-DES-008: 最小限の公開 (Principle of Least Exposure):**
    *   外部に公開する必要のない型やメンバーは、`internal` や `private` とします。

## 2. APIドキュメンテーション (API仕様書作成ガイドライン)

BitzBufferでは、ソースコードの可読性を優先するため、原則としてXMLドキュメントコメント (`///`) は使用しません。代わりに、公開APIの仕様は、別途Markdown形式で作成される**API仕様書**に記述し、「`../04.インターフェイス仕様書/`」フォルダ内に管理します（このフォルダは将来的に作成）。

*   **FR-API-DOC-001: API仕様書の目的:**
    *   ライブラリ利用者が、BitzBufferの各公開APIの機能、使用方法、パラメータ、戻り値、制約、例外条件などを正確かつ容易に理解できるようにするための公式リファレンスを提供します。
*   **FR-API-DOC-002: API仕様書の対象範囲:**
    *   ライブラリが公開する全ての `public` および `protected` な型とメンバー。
*   **FR-API-DOC-003: API仕様書の保管場所と形式:**
    *   **保管場所:** `../04.インターフェイス仕様書/` フォルダ（将来的に作成）。
    *   **形式:** Markdown (`.md`) ファイル。型ごとに1ファイルが基本。
    *   **目次:** `../04.インターフェイス仕様書/README.md` に各APIドキュメントへのリンクを作成します。
*   **FR-API-DOC-004: API仕様書の構成テンプレート:**
    *   各型のAPI仕様書Markdownファイルは、**[`../04.インターフェイス仕様書/Z1_テンプレート.md`](../04.インターフェイス仕様書/Z1_テンプレート.md)** （将来的に作成）で定義されたテンプレートに従って作成します。
*   **FR-API-DOC-005: 記述スタイルと規約:**
    *   説明文は明確かつ簡潔に。「[`04_ドキュメント規則.md`](./04_ドキュメント規則.md)」で定める一般的な記述スタイルに従います。
    *   型名、メソッド名等はソースコードと完全に一致させます。
    *   コード例はコンパイル可能で典型的な使用方法を示すものとします。
*   **FR-API-DOC-006: API仕様書の更新プロセス:**
    *   公開APIの追加・変更時は、必ず対応するAPI仕様書も同時に更新します。
    *   プルリクエストには、コード変更とAPI仕様書変更をレビュー対象として含めます。

## 3. APIのバージョン管理と互換性

*   **FR-API-VER-001: セマンティックバージョニング (Semantic Versioning 2.0.0) の採用:**
    *   バージョン番号は `MAJOR.MINOR.PATCH` 形式。
    *   MAJOR: 互換性のないAPI変更。
    *   MINOR: 後方互換性のある機能追加。
    *   PATCH: 後方互換性のあるバグ修正。
*   **FR-API-VER-002: 破壊的変更の最小化:**
    *   公開APIに対する破壊的変更は可能な限り避けます。やむを得ない場合はMAJORバージョンを上げ、リリースノートで詳細を説明します。
*   **FR-API-VER-003: 非推奨APIの扱い (Deprecation Policy):**
    *   APIを非推奨とする場合は `[Obsolete("メッセージ")]` 属性を付与し、代替APIを案内。API仕様書にも明記。
    *   少なくとも1メジャーバージョンアップを経てから削除を検討。
*   **FR-API-VER-004: リリースノートの作成:**
    *   各リリースで変更点等をまとめたリリースノートを作成・公開します。（詳細は [`08_ビルドとリリース手順.md`](./08_ビルドとリリース手順.md) を参照）

## 4. エラー処理に関するAPI設計

*   **FR-API-ERR-001: 例外によるエラー通知:**
    *   メソッドの事前条件違反や深刻な状態は例外で通知。標準例外型を適切に使用。
    *   BitzBuffer固有の例外には専用カスタム例外クラスを検討。
*   **FR-API-ERR-002: Tryパターン:**
    *   失敗が正常系の範囲内で起こりうる操作（例: `TryRent`）には、例外を発生させずに成否と結果を返す `bool Try...` パターンの提供を検討。
*   エラー処理の全体戦略は「`../03.詳細仕様書/BitzBuffer/05_エラーハンドリング.md`」を参照。
