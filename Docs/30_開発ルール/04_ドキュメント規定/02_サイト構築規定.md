# 02. サイト構築規定

このドキュメントは、本プロジェクトのドキュメントソース（Markdown）から、静的ドキュメントサイトを構築し、公開するための技術的なルールと手順を定めます。

## 1. 基本方針

- **目的:** ドキュメントの可読性と保守性を高めるため、一貫したルールに基づいてドキュメントサイトを構築します。
- **単一の情報源:** サイトの構造や設定は、この規定と関連する設定ファイル（`mkdocs.yml`）で一元管理します。

## 2. サイト構築ツール

- **ジェネレータ:** 本プロジェクトでは、静的サイトジェネレータとして **MkDocs** を利用します。
- **テーマ:** 可読性と機能性に優れた **Material for MkDocs** テーマを利用します。
- **プラグイン:**
    - **`mkdocs-awesome-nav`:** ナビゲーションの自動生成に利用します。
    - **`mkdocs-exclude`:** ビルド対象から特定のファイルを除外するために利用します。

## 3. ナビゲーション管理

サイトのナビゲーションは、`mkdocs-awesome-nav`プラグインによって、`Docs/`ディレクトリのフォルダ・ファイル構造に基づき、原則として自動で構築されます。

### 3.1. ナビゲーションの表示形式（タブ vs ドロップダウン）

`Material for MkDocs`テーマでは、トップレベルのナビゲーションをタブ形式で表示する機能 (`navigation.tabs`) があります。
本プロジェクトでは、階層構造をより明確に表示するため、この機能を**無効**にし、ドロップダウン形式のメニューを採用しています。

- **現在の設定 (`mkdocs.yml`):**

    ```yaml
    theme:
        name: material
        features:
            # - navigation.tabs # <- TOPメニューをドロップダウンにするため無効
            - navigation.sections
    ```

- **タブ形式に変更する場合:**
  `mkdocs.yml`の`features`セクションで`- navigation.tabs`のコメントを解除することで、タブ表示に切り替えることができます。

### 3.2. ナビゲーションのカスタマイズ

ナビゲーションの**表示順**と**タイトル**は、`mkdocs-awesome-nav`プラグインによって制御されます。

#### 表示順の制御

- **ルール:** ファイル・フォルダ名の先頭に `XX_` 形式の数字を付与することで、表示順を制御します。
- **利点:** シンプルで直感的です。
- **欠点:** 表示順を変更するために、ファイルやフォルダのリネームが必要です。

#### ナビゲーションタイトルの制御

- **ルール:** ナビゲーションに表示されるタイトルは、Markdownファイル内のH1見出しではなく、**ファイル名から自動的に生成**されます。
    - `mkdocs.yml`の`awesome-nav`プラグインで `filename_title: true` が設定されています。
    - この設定により、ファイル名の先頭にある数字プレフィックス（`01_`など）と拡張子（`.md`）が自動的に除去され、残った部分がタイトルとして使用されます。
    - 例: `01_セットアップガイド.md` というファイルは、ナビゲーション上で「セットアップガイド」と表示されます。
- **利点:** ファイル名の数字が表示されず、スッキリとしたナビゲーションになります。
- **注意点:** ナビゲーションのタイトルを変更したい場合は、Markdownファイル内の見出しではなく、**ファイル名を変更する**必要があります。

#### 高度なカスタマイズ: `.pages` ファイル

- **ルール:** 各ディレクトリに `.pages` という名前のファイルを作成し、その中にナビゲーションの構造をYAML形式で記述します。
- **利点:**
    - ファイル名を変更することなく、自由な表示順やタイトルを設定できます。
    - 複数のファイルを一つのセクションにまとめるなど、柔軟なグルーピングが可能です。
- **設定例 (`Docs/04_開発ルール/.pages`):**

    ```yaml
    # .pages
    title: 開発のルール # ナビゲーションに表示されるタイトル
    nav:
        - 概要: README.md
        - セットアップ: 00_セットアップガイド/README.md
        - ...
    ```

- **参考:** mkdocs-awesome-nav - Customizing the navigation

現在のプロジェクトでは、シンプルさを優先してファイル名のプレフィックスと`filename_title`オプションを組み合わせた方法を採用していますが、将来的にナビゲーション構造が複雑化した際には、`.pages`ファイルの導入を検討してください。

## 4. ビルド対象からのファイル除外

`mkdocs-exclude`プラグインを利用して、サイトに含めたくないファイルやフォルダをビルド対象から除外します。

- **`README.md`の扱い:** GitHub閲覧用の`README.md`は、`Docs/`直下のものを除き、すべてビルド対象から除外します。
- **【重要】プラグインの順序:** `exclude`プラグインは、ナビゲーションが生成される前に不要なファイルを取り除くため、必ず`awesome-nav`プラグインよりも**前に**記述する必要があります。
- **設定例 (`mkdocs.yml`):**

    ```yaml
    plugins:
        - search
        # 最初に不要なファイルを除外
        - exclude:
              glob:
                  - '**/README.md'
                  - '!README.md' # Docs/直下のREADMEは除外しない
                  - '**/bin/**'
                  - '**/obj/**'
        # 除外後のファイルリストでナビゲーションを自動生成
        - awesome-nav
    ```

## 5. ローカル環境でのプレビュー

ドキュメントの変更をコミットする前に、ローカル環境で表示崩れやリンク切れがないかを確認することを強く推奨します。

1. **必要なツールのインストール:**

    ```bash
    pip install mkdocs-material mkdocs-awesome-nav mkdocs-exclude pymdown-extensions mkdocs-git-revision-date-localized-plugin
    ```

2. **プレビューサーバーの起動:**
   リポジトリのルートディレクトリで以下のコマンドを実行します。

    ```bash
    mkdocs serve
    ```

3. **ブラウザで確認:** `http://127.0.0.1:8000` にアクセスし、変更内容を確認します。

## 6. サイトの公開（デプロイ）

- **ホスティング:** 本プロジェクトのドキュメントサイトは、**GitHub Pages**を利用して公開します。

- **自動デプロイ:** `main`ブランチへのマージをトリガーとして、GitHub Actionsのワークフローが自動的にサイトをビルドし、デプロイします。
- **Actionsの設定:** ワークフローファイル内のライブラリインストールコマンドには、本規定で利用する全てのプラグインを含める必要があります。

    ```yaml
    # GitHub Actions ワークフローファイル内
    - name: Install dependencies
      run: pip install mkdocs-material mkdocs-awesome-nav mkdocs-exclude
    ```
