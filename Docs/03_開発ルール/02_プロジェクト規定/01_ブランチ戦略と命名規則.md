# 02_ブランチ戦略と命名規則

このドキュメントでは、BitzBufferプロジェクト開発におけるGitのブランチ戦略と命名規則について説明します。
一人開発であっても、一貫したブランチ戦略を持つことで、開発プロセスの整理、変更履歴の追跡、そして将来の自分自身のための明確な記録を残すことができます。

## 1. 基本方針

本プロジェクトでは、シンプルで柔軟な **GitHub Flow** をベースとしたブランチ戦略を採用します。

*   **`main` ブランチ:**
    *   常に安定しており、リリース可能な状態（または最新の安定版）を保ちます。
    *   直接このブランチにコミットすることは**絶対に避け**、プルリクエスト (Pull Request, PR) 経由でのみ変更をマージします。

## 2. ブランチの種類と命名規則

作業の種類に応じて、以下の命名規則でブランチを作成します。ブランチ名には、可能な限り関連するGitHub Issue番号（詳細は [`03_Issue管理と運用ガイドライン.md`](./03_Issue管理と運用ガイドライン.md) を参照）を含めることを強く推奨します。これにより、ブランチの目的が明確になり、Issueとの関連付けも容易になります。

ブランチ名のプレフィックスは、そのブランチの主な目的を示します。

### 2.1. `main` ブランチ

*   **名前:** `main`
*   **役割:** プロジェクトの主軸となる最も安定したブランチ。タグ付けによるバージョンリリースの基点となります。

### 2.2. フィーチャーブランチ (Feature Branches)

新しい機能を追加したり、既存機能を拡張したりする際に使用します。

*   **命名規則:** `feat/<Issue番号>-<簡単な説明>`
    *   例: `feat/12-implement-segmented-buffer`
    *   例: `feat/34-add-zero-copy-attach-api`
*   **派生元:** `main`
*   **マージ先:** `main` (プルリクエスト経由)

### 2.3. バグ修正ブランチ (Bugfix Branches)

バグを修正する際に使用します。

*   **命名規則:** `fix/<Issue番号>-<簡単な説明>`
    *   例: `fix/42-resolve-memory-leak-in-pooling`
*   **派生元:** `main`
*   **マージ先:** `main` (プルリクエスト経由)

### 2.4. リファクタリングブランチ (Refactor Branches)

コードの内部構造を改善し、可読性、保守性、パフォーマンスを向上させる際に使用します。外部から見た動作（APIなど）は変更しません。

*   **命名規則:** `refact/<Issue番号>-<簡単な説明>`
    *   例: `refact/61-optimize-native-memory-allocation`
*   **派生元:** `main`
*   **マージ先:** `main` (プルリクエスト経由)

### 2.5. ドキュメントブランチ (Documentation Branches)

設計仕様書、README、その他のドキュメントの作成・修正を行う際に使用します。ドキュメントの作成ルールについては [`04_ドキュメント規則.md`](./04_ドキュメント規則.md) を参照してください。

*   **命名規則:** `docs/<Issue番号>-<簡単な説明>`
    *   例: `docs/92-update-pooling-strategy-spec`
    *   例: `docs/95-create-api-reference-template`
*   **派生元:** `main`
*   **マージ先:** `main` (プルリクエスト経由)

### 2.6. その他タスクブランチ (Task/Chore Branches)

上記に当てはまらない一般的なタスクや、ビルド設定の変更、ライブラリのアップデート、CI/CDの設定、実験的な試みなどを行う際に使用します。

*   **命名規則:** `task/<Issue番号>-<簡単な説明>`
    *   例: `task/101-setup-github-actions-ci`
    *   例: `task/105-add-benchmark-project`
*   **派生元:** `main`
*   **マージ先:** `main` (プルリクエスト経由)

## 3. 基本的なワークフロー

1.  **Issueの作成 (強く推奨):**
    *   これから行う作業に対応するIssueをGitHub上で作成します。（詳細は [`03_Issue管理と運用ガイドライン.md`](./03_Issue管理と運用ガイドライン.md)）
2.  **`main` ブランチの最新化:**
    *   `git checkout main`, `git pull origin main`
3.  **作業ブランチの作成:**
    *   `git checkout -b feat/123-my-new-feature main`
4.  **ローカルでの作業とコミット:**
    *   意味のある単位でコミット。メッセージに `Closes #123` などを含める。
5.  **リモートへのプッシュ:**
    *   `git push -u origin feat/123-my-new-feature`
6.  **プルリクエスト (PR) の作成:**
    *   作業ブランチから `main` ブランチへのPRを作成。
7.  **セルフレビュー:**
    *   自身の変更内容を客観的にレビュー。
8.  **自動テストの確認 (CI):**
    *   設定されていれば、ビルドとテストの結果を確認。
9.  **プルリクエストのマージ:**
    *   レビューとテストに問題がなければ `main` へマージ。
10. **マージ後のブランチ削除:**
    *   作業ブランチを削除。
11. **(任意) タグ付けとリリース:**
    *   リリース準備が整ったらバージョンタグを付与。（詳細は [`08_ビルドとリリース手順.md`](./08_ビルドとリリース手順.md)）

## 4. プルリクエスト (PR) の役割

*   **変更履歴の明確化**
*   **セルフレビューの機会**
*   **CI/CDのトリガー**
*   **変更の単位化**

## 5. コミットメッセージの指針

*   **簡潔かつ具体的**
*   **英語での記述を基本とし、現在形・命令形で** (例: `Feat: Add pooling statistics API`)
*   **プレフィックスの活用 (推奨):** `feat:`, `fix:`, `docs:`, `style:`, `refactor:`, `test:`, `chore:`
*   **関連Issueの記述:** `Closes #123` など。

## 6. まとめ

このブランチ戦略と命名規則に従うことで、BitzBufferの開発プロセスが整理され、変更の追跡が容易になり、プロジェクトの品質維持に貢献します。

