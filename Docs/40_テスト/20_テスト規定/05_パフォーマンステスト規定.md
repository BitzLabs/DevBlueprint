# パフォーマンステスト規定

このドキュメントは、パフォーマンステスト（性能テスト）の実装に関する具体的な規約を定めます。性能要件（応答時間、スループット、リソース使用率など）を満たしているかを検証します。

## 定義と目的

- 定義: システムに負荷（リクエスト数、同時ユーザー数など）を与え、性能指標を測定・評価するテスト
- 目的:
    - 非機能要件で定義された性能目標の達成確認
    - 性能リグレッションの検出
    - ボトルネックの特定と改善方針の獲得
    - キャパシティプランニングの参考

## 種類

- ロードテスト（負荷テスト）: 通常〜ピーク時の想定負荷で目標達成を確認
- ストレステスト（限界テスト）: 想定を超える負荷で限界点や回復性を確認
- マイクロベンチマーク: 特定の関数/アルゴリズムの実行速度やメモリを高精度に測定

## 推奨ツール

- API/Webサイトの負荷: k6（推奨）、JMeter
- コードレベルのマイクロベンチマーク:
    - C#: BenchmarkDotNet
    - Python: pytest-benchmark / timeit
    - JS/TS: Benchmark.js

## 実装パターン

### ロードテストのシナリオ

- 現実的なシナリオ: 単一エンドポイントではなく、複数APIを順序呼び出し（ログイン→一覧→詳細など）
- Think Time: ランダム待機時間を挿入
- 段階的な負荷（Ramp-up）: ゼロから目標値まで徐々に上げる

```javascript
import http from 'k6/http';
import { sleep, check } from 'k6';

export const options = {
    stages: [
        { duration: '30s', target: 20 },
        { duration: '1m', target: 20 },
        { duration: '10s', target: 0 },
    ],
    thresholds: {
        http_req_duration: ['p(95)<200'],
    },
};

export default function () {
    const res = http.get('https://test-api.example.com/public/crocodiles/1/');
    check(res, { 'status was 200': r => r.status == 200 });
    sleep(1);
}
```

## 注意事項

- 本番環境での実行禁止: 完全に同一構成の検証環境を用意
- ベースライン測定: 初回結果を基準値として保存し、以降は比較
- CI統合: リグレッション監視のために定期実行（夜間バッチなど）
